{"version":3,"sources":["../../../../src/components/messages/GospelLetterPresentation.jsx/__nextjs-internal-proxy.mjs","../../../../src/app/test2/page.jsx","../../../../src/lib/gospel-notion.js"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/messages/GospelLetterPresentation.jsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/messages/GospelLetterPresentation.jsx\",\n    \"default\",\n);\n","import React from 'react';\nimport GospelLetterPresentation from '../../components/messages/GospelLetterPresentation';\nimport Header from '../../components/Header';\nimport Footer from '../../components/Footer';\nimport { getLatestGospelLetter } from '../../lib/gospel-notion';\n\n// Force dynamic rendering to ensure fresh data from Notion on each request\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 0;\n\nconst GospelLetterPage = async () => {\n    const letter = await getLatestGospelLetter();\n\n    if (!letter) {\n        return (\n            <div className=\"min-h-screen bg-[#F4F3EF] flex flex-col items-center justify-center font-pretendard\">\n                <Header />\n                <div className=\"text-center p-8\">\n                    <h1 className=\"text-2xl font-bold text-[#05121C] mb-4\">No Letter Found</h1>\n                    <p className=\"text-[#2A4458]\">Please check back later.</p>\n                </div>\n                <Footer />\n            </div>\n        );\n    }\n\n    return (\n        <>\n            <Header />\n            <GospelLetterPresentation letter={letter} />\n            <Footer />\n        </>\n    );\n};\n\nexport default GospelLetterPage;\n","import { Client } from '@notionhq/client';\nimport { getScripture } from './bible';\n\nconst NOTION_GOSPEL_DB_ID = process.env.NOTION_GOSPEL_DB_ID;\nconst NOTION_API_KEY = process.env.NOTION_API_KEY;\n\nconst notion = new Client({\n    auth: NOTION_API_KEY,\n});\n\n/**\n * Fetches the latest Gospel Letter from the database.\n * Sorts by 'Date' descending and picks the first one.\n */\nexport async function getLatestGospelLetter() {\n    if (!NOTION_GOSPEL_DB_ID || !NOTION_API_KEY) {\n        console.error(\"Missing Notion Env Vars\");\n        return null;\n    }\n\n    try {\n        const response = await notion.databases.query({\n            database_id: NOTION_GOSPEL_DB_ID,\n            sorts: [\n                {\n                    property: 'Date',\n                    direction: 'descending',\n                },\n            ],\n            page_size: 1,\n        });\n\n        if (response.results.length === 0) {\n            return null;\n        }\n\n        const page = response.results[0];\n        const pageId = page.id;\n\n        // Extract metadata\n        const titleProp = page.properties.Title; // Adjust if property name differs\n        const dateProp = page.properties.Date;\n        const sundayRelation = page.properties.Sunday;\n\n        const title = titleProp?.title?.[0]?.plain_text || \"Untitled\";\n        const date = dateProp?.date?.start || \"\";\n\n        // Fetch blocks (content)\n        const blocks = await fetchBlocks(pageId);\n\n        // Parse content and extract scriptures\n        const { content, scriptureTags } = parseContent(blocks);\n\n        // Resolve scripture texts\n        const resolvedScriptures = scriptureTags.map(tag => {\n            const lookup = getScripture(tag);\n            return {\n                reference: tag,\n                text: lookup.text || null // Ensure null if not found\n            };\n        });\n\n        return {\n            id: pageId,\n            title,\n            date,\n            content, // Array of block objects for NotionRenderer\n            scriptureTags: resolvedScriptures, // Array of { reference, text }\n        };\n\n    } catch (error) {\n        console.error(\"Error fetching Gospel Letter:\", error);\n        return null;\n    }\n}\n\nasync function fetchBlocks(blockId) {\n    const blocks = [];\n    let cursor;\n    while (true) {\n        const { results, next_cursor } = await notion.blocks.children.list({\n            start_cursor: cursor,\n            block_id: blockId,\n        });\n        blocks.push(...results);\n        if (!next_cursor) {\n            break;\n        }\n        cursor = next_cursor;\n    }\n    return blocks;\n}\n\nfunction parseContent(blocks) {\n    const content = [];\n    const scriptureTags = [];\n\n    for (const block of blocks) {\n        // Simple heuristic: check if block is paragraph and starts with #\n        if (block.type === 'paragraph' && block.paragraph.rich_text.length > 0) {\n            const text = block.paragraph.rich_text.map(t => t.plain_text).join('');\n            if (text.trim().startsWith('#')) {\n                // It's a scripture tag line\n                // Can contain multiple tags? \" #John 3:16 #Gen 1:1 \" or just one line?\n                // Assumption: The whole line is tags or starts with one.\n                // Let's strip '#' and trim.\n                // e.g. text: \"#Deut 8:3\" -> \"Deut 8:3\"\n                const tags = text.split('#').filter(t => t.trim().length > 0).map(t => t.trim());\n                scriptureTags.push(...tags);\n                continue; // Skip adding this block to main content\n            }\n        }\n        content.push(block);\n    }\n\n    return { content, scriptureTags };\n}\n\n"],"names":[],"mappings":"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","ignoreList":[0]}